{
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        2528,
        608
      ],
      "id": "bbf3a799-46ca-4061-b090-34f8fc276542",
      "name": "When chat message received",
      "webhookId": "8e54da58-bee6-44a0-ab27-1aba8610a742"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=`Voc√™ √© o Na R√©gua, barbeiro virtual da Barbearia Estilo Masculino. \n\n## SUA PERSONALIDADE:\n- Barbeiro experiente e descontra√≠do\n- Fala a linguagem do cliente, com girias moderadas\n- Usa emojis de forma natural para dar calor humano\n- Extremamente conhecedor de cortes e estilos masculinos\n- Sempre d√° dicas de cuidado com a barba e cabelo\n- Trata todos os clientes como \"mano\" ou \"chefe\" de forma respeitosa\n\n## REGRAS DO ATENDIMENTO:\n1. SEMPRE seja aut√™ntico e genu√≠no\n2. Use express√µes como \"valeu\", \"tranquilo\", \"fechou?\"\n3. Mantenha o humor leve mas profissional\n4. Confirme todos os agendamentos com detalhes\n5. Ofere√ßa sempre um caf√© virtual ‚òï no final\n\n## SERVI√áOS DA BARBEARIA:\n- üíá Corte de cabelo tradicional\n- ‚úÇÔ∏è Corte degrad√™ e moderno\n- üßî Modelagem e tratamento de barba\n- üíà Navalha e detalhes precisos\n- üß¥ Relaxamento com toalha quente\n- üßº Lavagem com produtos premium\n\n## FORMATO DAS RESPOSTAS:\nüîß [Solu√ß√£o principal com emoji tem√°tico]\n\nüìã [Detalhes importantes]\n\nüí° [Dica extra ou sugest√£o]\n\nü§ù [Encerramento caracter√≠stico]\n\n## CONTEXTO ATUAL:\nData/hora: ${$now.format('DD/MM/YYYY √†s HH:mm')}\nCliente: 'chefe'}\nWhatsApp:\nMensagem: {{ $json.chatInput }}\n\n## HIST√ìRICO DA CONVERSA:\n${$('Mem√≥ria da Conversa1').item.json.context}\n\n## SUA MISS√ÉO:\nResponder ao cliente de forma natural, como um barbeiro de confian√ßa que conversa no WhatsApp!`",
        "options": {
          "systemMessage": "={{ `Voc√™ √© o Cl√©ber, barbeiro virtual da Barbearia Estilo Masculino com 15 anos de experi√™ncia. Voc√™ fala naturalmente como um profissional de barbearia que atende no WhatsApp:\n\n‚Ä¢ Usa express√µes: \"e a√≠ chefe\", \"tranquilo mano\", \"fechou?\", \"valeu!\", \"pode deixar\"\n‚Ä¢ Conhece todos os cortes: undercut, fade, degrad√™, social, militar\n‚Ä¢ Sabe sobre produtos: pomadas, gel, √≥leo para barba, finalizadores\n‚Ä¢ Oferece sempre um \"caf√© virtual\" no final: ‚òï\n\nData: ${$now.format('dddd, DD [de] MMMM')}\nHor√°rio: ${$now.format('HH:mm')}\n\nSempre use as ferramentas para agendar, confirmar ou cancelar hor√°rios diretamente no Google Calendar. Confirme TUDO com o cliente antes de marcar!` }}",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        2816,
        608
      ],
      "id": "9874f497-9cdf-4e57-9116-63e596bcab7c",
      "name": "Agente - Barbeiro Virtual",
      "alwaysOutputData": true,
      "retryOnFail": false
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2720,
        832
      ],
      "id": "b486653c-cd8b-49dd-8793-03f86fbb0a2f",
      "name": "Mem√≥ria da Conversa1"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Cancele o agendamento na barbearia com essa tool.",
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "846b793c13702beb7662850e9cd755e87476f1b9b1543f451dbe4b31ba1f3283@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Automa√ß√£o"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        2848,
        832
      ],
      "id": "d22a8d2b-16fa-40d2-922d-c94350aa767d",
      "name": "cancelarAgendamento1",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "nRGki09fLIlBWYCl",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Obtenha a lista de agendamentos, hor√°rios dispon√≠veis e clientes agendados.",
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "846b793c13702beb7662850e9cd755e87476f1b9b1543f451dbe4b31ba1f3283@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Automa√ß√£o"
        },
        "returnAll": true,
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        2976,
        832
      ],
      "id": "e021c77c-0761-4e0f-a85a-c0b50164e32f",
      "name": "verAgendamentos1",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "nRGki09fLIlBWYCl",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Atualize ou edite o agendamento do cliente com essa tool.",
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "846b793c13702beb7662850e9cd755e87476f1b9b1543f451dbe4b31ba1f3283@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Automa√ß√£o"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
        "updateFields": {
          "attendeesUi": {
            "values": {
              "attendees": [
                "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', ``, 'string') }}"
              ]
            }
          },
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
          "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ID', ``, 'string') }}",
          "location": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Location', ``, 'string') }}",
          "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        3104,
        832
      ],
      "id": "b1e89a51-83f7-4c6d-a444-8b27f800f398",
      "name": "atualizarAgendamento1",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "nRGki09fLIlBWYCl",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Agende o hor√°rio na barbearia com essa tool.",
        "calendar": {
          "__rl": true,
          "value": "846b793c13702beb7662850e9cd755e87476f1b9b1543f451dbe4b31ba1f3283@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Automa√ß√£o"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', ``, 'string') }}"
          ],
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "location": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Location', ``, 'string') }}",
          "sendUpdates": "all",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        3232,
        832
      ],
      "id": "5bd6b5e1-1a69-4fd9-9234-4a6fe4ce4855",
      "name": "agendarHorario1",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "nRGki09fLIlBWYCl",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "if ($input.first().json.output === undefined || $input.first().json.output === '') {\n  return [{ json: { \n    response: '‚úã E a√≠, chefe! N√£o consegui entender direito. Pode repetir? ü§î\\n\\nüîß Se for sobre:\\n‚Ä¢ ‚úÇÔ∏è Agendar hor√°rio\\n‚Ä¢ üóìÔ∏è Ver disponibilidade\\n‚Ä¢ üíà Pre√ßos\\n‚Ä¢ ‚ùå Cancelar\\n\\nü§ù Manda ver que a gente resolve! ‚òï'\n  } }];\n}\nreturn $input.first();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3248,
        608
      ],
      "id": "6b4be90c-5e90-4b0c-b1da-647f91356a50",
      "name": "Resposta de Fallback1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2592,
        832
      ],
      "id": "53ad38e9-3cac-4c9c-a200-4c822e2f67fd",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "YatACCEanvcSQFIg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente - Barbeiro Virtual": {
      "main": [
        [
          {
            "node": "Resposta de Fallback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mem√≥ria da Conversa1": {
      "ai_memory": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "cancelarAgendamento1": {
      "ai_tool": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "verAgendamentos1": {
      "ai_tool": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "atualizarAgendamento1": {
      "ai_tool": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "agendarHorario1": {
      "ai_tool": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Resposta de Fallback1": {
      "main": [
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente - Barbeiro Virtual",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6112025a44a9975746a08508c1d5bb8cb6ab81a9459e4591d6ec49aad054780d"
  }
}